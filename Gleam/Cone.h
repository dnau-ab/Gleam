#pragma once
#include "Renderable.h"
#include "Material.h"

class Cone : public Renderable {
private:
	unsigned int _VAO;
	unsigned int _VBO;
	unsigned int _numVertices;

protected:
	void init() {
		float coneVertices[] = {
			// position   // normals   // texture coords
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0, -1, 1, 0, -1, 0, 0.5, 0,
			-0.19509, -1, 0.980785, 0, -1, 0, 0.597545, 0.00960702,
			-0.19509, -1, 0.980785, 0, -1, 0, 0.597545, 0.00960702,
			-0.382683, -1, 0.92388, 0, -1, 0, 0.691342, 0.03806,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.707107, -1, 0.707107, 0, -1, 0, 0.853553, 0.146447,
			-0.83147, -1, 0.55557, 0, -1, 0, 0.915735, 0.222215,
			-0.83147, -1, 0.55557, 0, -1, 0, 0.915735, 0.222215,
			-0.92388, -1, 0.382683, 0, -1, 0, 0.96194, 0.308658,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.92388, -1, 0.382683, 0, -1, 0, 0.96194, 0.308658,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-1, -1, 0, 0, -1, 0, 1, 0.5,
			-0.980785, -1, -0.19509, 0, -1, 0, 0.990393, 0.597545,
			-0.980785, -1, -0.19509, 0, -1, 0, 0.990393, 0.597545,
			-0.92388, -1, -0.382683, 0, -1, 0, 0.96194, 0.691342,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.92388, -1, -0.382683, 0, -1, 0, 0.96194, 0.691342,
			-0.83147, -1, -0.55557, 0, -1, 0, 0.915735, 0.777785,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.83147, -1, -0.55557, 0, -1, 0, 0.915735, 0.777785,
			-0.707107, -1, -0.707107, 0, -1, 0, 0.853553, 0.853553,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			-0.707107, -1, -0.707107, 0, -1, 0, 0.853553, 0.853553,
			-0.55557, -1, -0.83147, 0, -1, 0, 0.777785, 0.915735,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			-0.55557, -1, -0.83147, 0, -1, 0, 0.777785, 0.915735,
			-0.382683, -1, -0.92388, 0, -1, 0, 0.691342, 0.96194,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			0, -1, -1, 0, -1, 0, 0.5, 1,
			0.195091, -1, -0.980785, 0, -1, 0, 0.402455, 0.990393,
			0.195091, -1, -0.980785, 0, -1, 0, 0.402455, 0.990393,
			0.382684, -1, -0.923879, 0, -1, 0, 0.308658, 0.96194,
			0.555571, -1, -0.831469, 0, -1, 0, 0.222215, 0.915735,
			0.555571, -1, -0.831469, 0, -1, 0, 0.222215, 0.915735,
			0.707107, -1, -0.707106, 0, -1, 0, 0.146446, 0.853553,
			0.83147, -1, -0.55557, 0, -1, 0, 0.084265, 0.777785,
			0.83147, -1, -0.55557, 0, -1, 0, 0.084265, 0.777785,
			0.92388, -1, -0.382683, 0, -1, 0, 0.03806, 0.691341,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			1, -1, 1e-06, 0, -1, 0, 0, 0.5,
			0.980785, -1, 0.195091, 0, -1, 0, 0.009607, 0.402454,
			0.980785, -1, 0.195091, 0, -1, 0, 0.009607, 0.402454,
			0.923879, -1, 0.382684, 0, -1, 0, 0.03806, 0.308658,
			0.831469, -1, 0.555571, 0, -1, 0, 0.084266, 0.222214,
			0.831469, -1, 0.555571, 0, -1, 0, 0.084266, 0.222214,
			0.707106, -1, 0.707108, 0, -1, 0, 0.146447, 0.146446,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0.707106, -1, 0.707108, 0, -1, 0, 0.146447, 0.146446,
			0.555569, -1, 0.83147, 0, -1, 0, 0.222215, 0.084265,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0.555569, -1, 0.83147, 0, -1, 0, 0.222215, 0.084265,
			0.382682, -1, 0.92388, 0, -1, 0, 0.308659, 0.03806,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			-0.19509, -1, 0.980785, 0, -1, 0, 0.597545, 0.00960702,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			0.195091, -1, -0.980785, 0, -1, 0, 0.402455, 0.990393,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.195091, -1, -0.980785, 0, -1, 0, 0.402455, 0.990393,
			0.555571, -1, -0.831469, 0, -1, 0, 0.222215, 0.915735,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.555571, -1, -0.831469, 0, -1, 0, 0.222215, 0.915735,
			0.83147, -1, -0.55557, 0, -1, 0, 0.084265, 0.777785,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0.980785, -1, 0.195091, 0, -1, 0, 0.009607, 0.402454,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0.980785, -1, 0.195091, 0, -1, 0, 0.009607, 0.402454,
			0.831469, -1, 0.555571, 0, -1, 0, 0.084266, 0.222214,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			-0.55557, -1, 0.83147, 0, -1, 0, 0.777785, 0.084265,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			-0.83147, -1, -0.55557, 0, -1, 0, 0.915735, 0.777785,
			-0.19509, -1, -0.980785, 0, -1, 0, 0.597545, 0.990393,
			0.195089, -1, 0.980786, 0, -1, 0, 0.402456, 0.00960702,
			-0.980785, -1, 0.19509, 0, -1, 0, 0.990393, 0.402455,
			0.980785, -1, -0.195089, 0, -1, 0, 0.009607, 0.597545,
			0, -1, 1, 0, -0.5033, 0.8641, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.19509, -1, 0.980785, -0.1686, -0.5033, 0.8475, 1, 0,
			-0.19509, -1, 0.980785, -0.1686, -0.5033, 0.8475, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.382683, -1, 0.92388, -0.3307, -0.5033, 0.7983, 1, 0,
			-0.382683, -1, 0.92388, -0.3307, -0.5033, 0.7983, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.55557, -1, 0.83147, -0.4801, -0.5033, 0.7185, 1, 0,
			-0.55557, -1, 0.83147, -0.4801, -0.5033, 0.7185, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.707107, -1, 0.707107, -0.611, -0.5033, 0.611, 1, 0,
			-0.707107, -1, 0.707107, -0.611, -0.5033, 0.611, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.83147, -1, 0.55557, -0.7185, -0.5033, 0.4801, 1, 0,
			-0.83147, -1, 0.55557, -0.7185, -0.5033, 0.4801, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.92388, -1, 0.382683, -0.7983, -0.5033, 0.3307, 1, 0,
			-0.92388, -1, 0.382683, -0.7983, -0.5033, 0.3307, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.980785, -1, 0.19509, -0.8475, -0.5033, 0.1686, 1, 0,
			-0.980785, -1, 0.19509, -0.8475, -0.5033, 0.1686, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-1, -1, 0, -0.8641, -0.5033, 0, 1, 0,
			-1, -1, 0, -0.8641, -0.5033, 0, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.980785, -1, -0.19509, -0.8475, -0.5033, -0.1686, 1, 0,
			-0.980785, -1, -0.19509, -0.8475, -0.5033, -0.1686, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.92388, -1, -0.382683, -0.7983, -0.5033, -0.3307, 1, 0,
			-0.92388, -1, -0.382683, -0.7983, -0.5033, -0.3307, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.83147, -1, -0.55557, -0.7185, -0.5033, -0.4801, 1, 0,
			-0.83147, -1, -0.55557, -0.7185, -0.5033, -0.4801, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.707107, -1, -0.707107, -0.611, -0.5033, -0.611, 1, 0,
			-0.707107, -1, -0.707107, -0.611, -0.5033, -0.611, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.55557, -1, -0.83147, -0.4801, -0.5033, -0.7185, 1, 0,
			-0.55557, -1, -0.83147, -0.4801, -0.5033, -0.7185, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.382683, -1, -0.92388, -0.3307, -0.5033, -0.7983, 1, 0,
			-0.382683, -1, -0.92388, -0.3307, -0.5033, -0.7983, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			-0.19509, -1, -0.980785, -0.1686, -0.5033, -0.8475, 1, 0,
			-0.19509, -1, -0.980785, -0.1686, -0.5033, -0.8475, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0, -1, -1, 0, -0.5033, -0.8641, 1, 0,
			0, -1, -1, 0, -0.5033, -0.8641, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.195091, -1, -0.980785, 0.1686, -0.5033, -0.8475, 1, 0,
			0.195091, -1, -0.980785, 0.1686, -0.5033, -0.8475, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.382684, -1, -0.923879, 0.3307, -0.5033, -0.7983, 1, 0,
			0.382684, -1, -0.923879, 0.3307, -0.5033, -0.7983, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.555571, -1, -0.831469, 0.4801, -0.5033, -0.7185, 1, 0,
			0.555571, -1, -0.831469, 0.4801, -0.5033, -0.7185, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.707107, -1, -0.707106, 0.611, -0.5033, -0.611, 1, 0,
			0.707107, -1, -0.707106, 0.611, -0.5033, -0.611, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.83147, -1, -0.55557, 0.7185, -0.5033, -0.4801, 1, 0,
			0.83147, -1, -0.55557, 0.7185, -0.5033, -0.4801, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.92388, -1, -0.382683, 0.7983, -0.5033, -0.3307, 1, 0,
			0.92388, -1, -0.382683, 0.7983, -0.5033, -0.3307, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.980785, -1, -0.195089, 0.8475, -0.5033, -0.1686, 1, 0,
			0.980785, -1, -0.195089, 0.8475, -0.5033, -0.1686, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			1, -1, 1e-06, 0.8641, -0.5033, 0, 1, 0,
			1, -1, 1e-06, 0.8641, -0.5033, 0, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.980785, -1, 0.195091, 0.8475, -0.5033, 0.1686, 1, 0,
			0.980785, -1, 0.195091, 0.8475, -0.5033, 0.1686, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.923879, -1, 0.382684, 0.7983, -0.5033, 0.3307, 1, 0,
			0.923879, -1, 0.382684, 0.7983, -0.5033, 0.3307, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.831469, -1, 0.555571, 0.7185, -0.5033, 0.4801, 1, 0,
			0.831469, -1, 0.555571, 0.7185, -0.5033, 0.4801, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.707106, -1, 0.707108, 0.611, -0.5033, 0.611, 1, 0,
			0.707106, -1, 0.707108, 0.611, -0.5033, 0.611, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.555569, -1, 0.83147, 0.4801, -0.5033, 0.7185, 1, 0,
			0.555569, -1, 0.83147, 0.4801, -0.5033, 0.7185, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.382682, -1, 0.92388, 0.3307, -0.5033, 0.7983, 1, 0,
			0.382682, -1, 0.92388, 0.3307, -0.5033, 0.7983, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0.195089, -1, 0.980786, 0.1686, -0.5033, 0.8475, 1, 0,
			0.195089, -1, 0.980786, 0.1686, -0.5033, 0.8475, 0, 1,
			0, 1, 0, 0, 1, 0, 1, 1,
			0, -1, 1, 0, -0.5033, 0.8641, 1, 0,
		};

		_numVertices = 186;

		// setup plane VAO
		glGenVertexArrays(1, &_VAO);
		glGenBuffers(1, &_VBO);
		glBindVertexArray(_VAO);
		glBindBuffer(GL_ARRAY_BUFFER, _VBO);
		glBufferData(GL_ARRAY_BUFFER, sizeof(coneVertices), &coneVertices, GL_STATIC_DRAW);
		glEnableVertexAttribArray(0);
		glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)0);
		glEnableVertexAttribArray(1);
		glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(3 * sizeof(float)));
		glEnableVertexAttribArray(2);
		glVertexAttribPointer(2, 2, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(6 * sizeof(float)));
	}

public:
	Material material;

	Cone() : material() {
		init();
		_shader = Shader::getDefault();
	}

	Cone(Material material) : material(material) {
		init();
		_shader = Shader::getDefault();
	}

	Cone(Shader* shader) : material() {
		init();
		_shader = shader;
	}

	Cone(Material material, Shader* shader) : material(material) {
		init();
		_shader = shader;
	}

	~Cone() {
		glDeleteVertexArrays(1, &_VAO);
		glDeleteBuffers(1, &_VBO);
	}

	void render(const glm::mat4& projection, const glm::mat4& view) override {
		if (_shader != nullptr) {
			_shader->use();
			_shader->setMat4("model", transform.getTransformationMatrix());
			_shader->setMat4("view", view);
			_shader->setMat4("projection", projection);
			_shader->setMat3("normalMat", getNormalMatrix());
			material.bind(_shader);
		}
		glBindVertexArray(_VAO);
		glDrawArrays(GL_TRIANGLES, 0, _numVertices);
		glBindVertexArray(0);
	}

};